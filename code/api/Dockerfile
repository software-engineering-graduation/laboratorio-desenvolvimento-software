FROM openjdk:19-alpine
WORKDIR /app
COPY . /app
RUN chmod +x mvnw

# Define build arguments
ARG SPRING_DATASOURCE_USERNAME
ARG SPRING_DATASOURCE_PASSWORD
ARG SPRING_DATASOURCE_HOSTNAME
ARG SPRING_DATASOURCE_DBNAME
ARG SPRING_PROFILES_ACTIVE

# Set environment variables inside the container
ENV SPRING_DATASOURCE_USERNAME=${SPRING_DATASOURCE_USERNAME}
ENV SPRING_DATASOURCE_PASSWORD=${SPRING_DATASOURCE_PASSWORD}
ENV SPRING_DATASOURCE_HOSTNAME=${SPRING_DATASOURCE_HOSTNAME}
ENV SPRING_DATASOURCE_DBNAME=${SPRING_DATASOURCE_DBNAME}
ENV SPRING_PROFILES_ACTIVE=${SPRING_PROFILES_ACTIVE}

RUN ./mvnw -B -DskipTests clean package
RUN apk --no-cache add findutils
EXPOSE 8080
CMD ["/bin/sh", "-c", "export $(cat .env | xargs) && java -jar -Dspring.profiles.active=$SPRING_PROFILES_ACTIVE target/todo-list-0.0.1-SNAPSHOT.jar"]